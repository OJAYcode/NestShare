@model Thrift.Models.ViewModels.BudgetViewModel

@{
    ViewData["Title"] = "Budget Calculator";
}

<div class="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 py-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb Navigation -->
        <nav class="flex mb-5" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a asp-controller="Budget" asp-action="Index" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-blue-600">
                        <i class="fas fa-file-invoice-dollar mr-2"></i>
                        Budgets
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2 text-xs"></i>
                        <a asp-action="Details" asp-route-id="@Model.Id" class="text-sm font-medium text-gray-500 hover:text-blue-600">
                            @Model.Name
                        </a>
                    </div>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 mx-2 text-xs"></i>
                        <span class="text-sm font-medium text-gray-700">Calculator</span>
                    </div>
                </li>
            </ol>
        </nav>

        <!-- Header Section -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-blue-600 to-blue-800 px-6 py-4">
                <div class="flex items-center justify-between">
                    <h1 class="text-2xl font-bold text-white">Budget Calculator</h1>
                    <span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">
                        @Model.Month
                    </span>
                </div>
                <p class="text-blue-100 mt-1">Make adjustments to see how changes affect your overall budget</p>
            </div>
            
            <form id="budgetForm" asp-action="Edit" asp-route-id="@Model.Id" method="post">
                <input type="hidden" asp-for="Id" />
                
                <div class="p-6">
                    <!-- Budget Name and Month Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="mb-4">
                            <label for="Name" class="block text-sm font-medium text-gray-700">Budget Name</label>
                            <input asp-for="Name" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" />
                        </div>
                        <div class="mb-4">
                            <label for="Month" class="block text-sm font-medium text-gray-700">Month</label>
                            <input asp-for="Month" class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" />
                        </div>
                    </div>
                    
                    <!-- Budget Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <!-- Income Card -->
                        <div class="bg-green-50 border border-green-100 rounded-lg p-5 transform transition duration-300 hover:scale-105">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-green-600 text-sm font-medium">Total Income</p>
                                    <h3 class="text-2xl font-bold text-gray-800 mt-1">$<span id="totalIncomeDisplay">0.00</span></h3>
                                </div>
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i class="fas fa-money-bill-wave text-green-500"></i>
                                </div>
                            </div>
                            <div class="mt-4 pt-3 border-t border-green-100">
                                <div class="text-xs font-medium text-green-600 flex justify-between">
                                    <span>Primary: $<span id="primaryIncomeDisplay">0.00</span></span>
                                    <span>Additional: $<span id="additionalIncomeDisplay">0.00</span></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expenses Card -->
                        <div class="bg-red-50 border border-red-100 rounded-lg p-5 transform transition duration-300 hover:scale-105">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-red-600 text-sm font-medium">Total Expenses</p>
                                    <h3 class="text-2xl font-bold text-gray-800 mt-1">$<span id="totalExpensesDisplay">0.00</span></h3>
                                </div>
                                <div class="bg-red-100 p-3 rounded-full">
                                    <i class="fas fa-shopping-cart text-red-500"></i>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div id="expenseProgressBar" class="bg-red-500 h-2.5 rounded-full" style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-gray-600 mt-1"><span id="expensePercentageDisplay">0</span>% of income spent</p>
                            </div>
                        </div>
                        
                        <!-- Remaining Card -->
                        <div class="bg-blue-50 border border-blue-100 rounded-lg p-5 transform transition duration-300 hover:scale-105">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-blue-600 text-sm font-medium">Remaining Budget</p>
                                    <h3 class="text-2xl font-bold text-gray-800 mt-1">$<span id="remainingBudgetDisplay" class="text-green-600">0.00</span></h3>
                                </div>
                                <div class="bg-blue-100 p-3 rounded-full">
                                    <i class="fas fa-wallet text-blue-500"></i>
                                </div>
                            </div>
                            <div class="mt-4 pt-3 border-t border-blue-100">
                                <p id="budgetStatus" class="text-xs font-medium text-blue-600">Your budget is balanced</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Budget Breakdown Visualization -->
                    <div class="mb-8 bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">Budget Breakdown</h2>
                        <div class="relative pt-1">
                            <div class="flex mb-2 items-center justify-between">
                                <div>
                                    <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                                        Income
                                    </span>
                                </div>
                                <div class="text-right">
                                    <span class="text-xs font-semibold inline-block text-green-600">
                                        $<span id="breakdownIncomeDisplay">0.00</span>
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                                <div id="incomeBar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500" style="width: 100%"></div>
                            </div>
                            
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-2">
                                <!-- Housing Bar -->
                                <div>
                                    <div class="flex mb-1 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-indigo-600 bg-indigo-200">
                                                <i class="fas fa-home mr-1"></i> Housing
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-indigo-600">
                                                $<span id="housingDisplay">0.00</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-gray-200">
                                        <div id="housingBar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <!-- Utilities Bar -->
                                <div>
                                    <div class="flex mb-1 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-yellow-600 bg-yellow-200">
                                                <i class="fas fa-bolt mr-1"></i> Utilities
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-yellow-600">
                                                $<span id="utilitiesDisplay">0.00</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-gray-200">
                                        <div id="utilitiesBar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <!-- Transportation Bar -->
                                <div>
                                    <div class="flex mb-1 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200">
                                                <i class="fas fa-car mr-1"></i> Transportation
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-blue-600">
                                                $<span id="transportationDisplay">0.00</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-gray-200">
                                        <div id="transportationBar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <!-- Food Bar -->
                                <div>
                                    <div class="flex mb-1 items-center justify-between">
                                        <div>
                                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-green-600 bg-green-200">
                                                <i class="fas fa-utensils mr-1"></i> Food
                                            </span>
                                        </div>
                                        <div class="text-right">
                                            <span class="text-xs font-semibold inline-block text-green-600">
                                                $<span id="foodDisplay">0.00</span>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="overflow-hidden h-2 mb-2 text-xs flex rounded bg-gray-200">
                                        <div id="foodBar" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-500" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <!-- Add other expense categories as bars... -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculator Form -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <!-- Income Section -->
                        <div class="bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="bg-green-100 p-2 rounded-md mr-2">
                                    <i class="fas fa-money-bill-wave text-green-600"></i>
                                </span>
                                Income
                            </h2>
                            
                            <div class="mb-4">
                                <label for="TotalIncome" class="block text-sm font-medium text-gray-700">Primary Income</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500 sm:text-sm">$</span>
                                    </div>
                                    <input asp-for="TotalIncome" type="number" id="TotalIncome" step="0.01" min="0" 
                                           class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                           placeholder="0.00">
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label for="AdditionalIncome" class="block text-sm font-medium text-gray-700">Additional Income</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span class="text-gray-500 sm:text-sm">$</span>
                                    </div>
                                    <input asp-for="AdditionalIncome" type="number" id="AdditionalIncome" step="0.01" min="0" 
                                           class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                           placeholder="0.00">
                                </div>
                            </div>
                            
                            <!-- Savings Goal -->
                            <div class="mt-6 bg-green-50 p-4 rounded-lg border border-green-100">
                                <h3 class="text-sm font-medium text-green-800 mb-2">Recommended Savings</h3>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-green-600">20% of income</span>
                                    <span class="text-sm font-bold text-green-700">$<span id="recommendedSavings">0.00</span></span>
                                </div>
                                <div class="mt-2 w-full bg-white rounded-full h-1.5">
                                    <div id="savingsProgressBar" class="bg-green-600 h-1.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="bg-blue-100 p-2 rounded-md mr-2">
                                    <i class="fas fa-chart-pie text-blue-600"></i>
                                </span>
                                Budget Overview
                            </h2>
                            
                            <!-- Replace the placeholder chart with a real chart -->
                            <div class="mb-6">
                                <h3 class="text-sm font-medium text-gray-700 mb-2">Expense Breakdown</h3>
                                <div class="h-64 bg-gray-50 rounded-lg p-2">
                                    <canvas id="expenseBreakdownChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Add a new row for additional charts -->
                        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <!-- Income vs Expenses Chart -->
                            <div class="bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                                <h3 class="text-sm font-medium text-gray-700 mb-2">Income vs Expenses</h3>
                                <div class="h-64 bg-gray-50 rounded-lg p-2">
                                    <canvas id="incomeExpensesChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                            
                            <!-- Category Spending Radar Chart -->
                            <div class="bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                                <h3 class="text-sm font-medium text-gray-700 mb-2">Spending by Category</h3>
                                <div class="h-64 bg-gray-50 rounded-lg p-2">
                                    <canvas id="categoryRadarChart" width="400" height="200"></canvas>
                                </div>
                                <p class="text-xs text-gray-500 mt-2 text-center">Current spending vs recommended percentages</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calculator Form Continued... -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <!-- Expenses Section -->
                        <div class="md:col-span-2 bg-white p-5 rounded-lg border border-gray-200 shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                <span class="bg-red-100 p-2 rounded-md mr-2">
                                    <i class="fas fa-shopping-cart text-red-600"></i>
                                </span>
                                Expenses
                            </h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-4">
                                <!-- Housing -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="HousingExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-home text-indigo-500 mr-2"></i> Housing
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="HousingExpenses" type="number" id="HousingExpenses" step="0.01" min="0" 
                                               class="focus:ring-indigo-500 focus:border-indigo-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 25-35%</span>
                                        <span id="housingPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Utilities -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="UtilitiesExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-bolt text-yellow-500 mr-2"></i> Utilities
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="UtilitiesExpenses" type="number" id="UtilitiesExpenses" step="0.01" min="0" 
                                               class="focus:ring-yellow-500 focus:border-yellow-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 5-10%</span>
                                        <span id="utilitiesPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Transportation -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="TransportationExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-car text-blue-500 mr-2"></i> Transportation
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="TransportationExpenses" type="number" id="TransportationExpenses" step="0.01" min="0" 
                                               class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 10-15%</span>
                                        <span id="transportationPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Food -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="FoodExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-utensils text-green-500 mr-2"></i> Food
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="FoodExpenses" type="number" id="FoodExpenses" step="0.01" min="0" 
                                               class="focus:ring-green-500 focus:border-green-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 10-15%</span>
                                        <span id="foodPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Healthcare -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="HealthcareExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-medkit text-red-500 mr-2"></i> Healthcare
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="HealthcareExpenses" type="number" id="HealthcareExpenses" step="0.01" min="0" 
                                               class="focus:ring-red-500 focus:border-red-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 5-10%</span>
                                        <span id="healthcarePercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Entertainment -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="EntertainmentExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-film text-purple-500 mr-2"></i> Entertainment
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="EntertainmentExpenses" type="number" id="EntertainmentExpenses" step="0.01" min="0" 
                                               class="focus:ring-purple-500 focus:border-purple-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 5-10%</span>
                                        <span id="entertainmentPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Personal -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="PersonalExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-user text-pink-500 mr-2"></i> Personal
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="PersonalExpenses" type="number" id="PersonalExpenses" step="0.01" min="0" 
                                               class="focus:ring-pink-500 focus:border-pink-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 5-10%</span>
                                        <span id="personalPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Savings -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="SavingsAllocation" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-piggy-bank text-teal-500 mr-2"></i> Savings
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="SavingsAllocation" type="number" id="SavingsAllocation" step="0.01" min="0" 
                                               class="focus:ring-teal-500 focus:border-teal-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 10-20%</span>
                                        <span id="savingsPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Debt Payment -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="DebtPayment" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-credit-card text-orange-500 mr-2"></i> Debt Payment
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="DebtPayment" type="number" id="DebtPayment" step="0.01" min="0" 
                                               class="focus:ring-orange-500 focus:border-orange-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Recommended: 10-20%</span>
                                        <span id="debtPercentage">0%</span>
                                    </div>
                                </div>
                                
                                <!-- Other -->
                                <div class="mb-4 bg-gray-50 p-3 rounded-lg border border-gray-100 hover:shadow-md transition-shadow duration-300">
                                    <label for="OtherExpenses" class="block text-sm font-medium text-gray-700 mb-2">
                                        <i class="fas fa-ellipsis-h text-gray-500 mr-2"></i> Other Expenses
                                    </label>
                                    <div class="relative rounded-md shadow-sm">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <span class="text-gray-500 sm:text-sm">$</span>
                                        </div>
                                        <input asp-for="OtherExpenses" type="number" id="OtherExpenses" step="0.01" min="0" 
                                               class="focus:ring-gray-500 focus:border-gray-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md"
                                               placeholder="0.00">
                                    </div>
                                    <div class="mt-2 flex justify-between text-xs text-gray-500">
                                        <span>Miscellaneous</span>
                                        <span id="otherPercentage">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Notes Section -->
                            <div class="mt-6">
                                <label for="Notes" class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                                <textarea asp-for="Notes" id="Notes" rows="3" 
                                          class="focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"
                                          placeholder="Add any notes about your budget here..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mt-8 flex flex-wrap gap-3">
                        <button type="submit" id="saveBudgetBtn"
                               class="inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                            <i class="fas fa-save mr-2"></i> Save Budget
                        </button>
                        <a asp-action="Details" asp-route-id="@Model.Id" 
                           class="inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                            <i class="fas fa-eye mr-2"></i> View Details
                        </a>
                        <a asp-action="Index" 
                           class="inline-flex items-center px-4 py-2 bg-gray-100 border border-gray-200 rounded-md font-semibold text-gray-600 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">
                            <i class="fas fa-arrow-left mr-2"></i> Back to Budgets
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Make sure this comes first and is loading properly -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <script>
        // Update totals when any expense or income field changes
        const updateTotals = () => {
            // Get all income values
            const totalIncome = parseFloat($('#TotalIncome').val()) || 0;
            const additionalIncome = parseFloat($('#AdditionalIncome').val()) || 0;
            const totalIncomeSum = totalIncome + additionalIncome;
            
            // Get all expense values
            const housing = parseFloat($('#HousingExpenses').val()) || 0;
            const utilities = parseFloat($('#UtilitiesExpenses').val()) || 0;
            const transportation = parseFloat($('#TransportationExpenses').val()) || 0;
            const food = parseFloat($('#FoodExpenses').val()) || 0;
            const healthcare = parseFloat($('#HealthcareExpenses').val()) || 0;
            const entertainment = parseFloat($('#EntertainmentExpenses').val()) || 0;
            const personal = parseFloat($('#PersonalExpenses').val()) || 0;
            const savings = parseFloat($('#SavingsAllocation').val()) || 0;
            const debt = parseFloat($('#DebtPayment').val()) || 0;
            const other = parseFloat($('#OtherExpenses').val()) || 0;
            
            // Calculate total expenses
            const totalExpenses = housing + utilities + transportation + food + 
                                healthcare + entertainment + personal + savings + 
                                debt + other;
            
            // Calculate remaining budget
            const remaining = totalIncomeSum - totalExpenses;
            
            // Update the display
            $('#totalIncomeDisplay').text(totalIncomeSum.toFixed(2));
            $('#primaryIncomeDisplay').text(totalIncome.toFixed(2));
            $('#additionalIncomeDisplay').text(additionalIncome.toFixed(2));
            $('#totalExpensesDisplay').text(totalExpenses.toFixed(2));
            $('#remainingBudgetDisplay').text(Math.abs(remaining).toFixed(2));
            $('#breakdownIncomeDisplay').text(totalIncomeSum.toFixed(2));
            $('#chartTotal').text(totalExpenses.toFixed(2));
            
            // Calculate recommended savings
            const recommendedSavings = totalIncomeSum * 0.2;
            $('#recommendedSavings').text(recommendedSavings.toFixed(2));
            
            // Calculate savings progress
            const savingsProgress = (savings / recommendedSavings) * 100;
            $('#savingsProgressBar').css('width', Math.min(savingsProgress, 100) + '%');
            
            // Update expense percentages
            const updatePercentage = (expense, total, elementId, barId) => {
                const percentage = total > 0 ? (expense / total) * 100 : 0;
                $(`#${elementId}`).text(percentage.toFixed(1) + '%');
                $(`#${barId}`).css('width', percentage + '%');
                $(`#${elementId.replace('Percentage', 'Display')}`).text(expense.toFixed(2));
            };
            
            updatePercentage(housing, totalIncomeSum, 'housingPercentage', 'housingBar');
            updatePercentage(utilities, totalIncomeSum, 'utilitiesPercentage', 'utilitiesBar');
            updatePercentage(transportation, totalIncomeSum, 'transportationPercentage', 'transportationBar');
            updatePercentage(food, totalIncomeSum, 'foodPercentage', 'foodBar');
            updatePercentage(healthcare, totalIncomeSum, 'healthcarePercentage', 'healthcareBar');
            updatePercentage(entertainment, totalIncomeSum, 'entertainmentPercentage', 'entertainmentBar');
            updatePercentage(personal, totalIncomeSum, 'personalPercentage', 'personalBar');
            updatePercentage(savings, totalIncomeSum, 'savingsPercentage', 'savingsBar');
            updatePercentage(debt, totalIncomeSum, 'debtPercentage', 'debtBar');
            updatePercentage(other, totalIncomeSum, 'otherPercentage', 'otherBar');
            
            // Update expense progress bar
            const expensePercentage = totalIncomeSum > 0 ? (totalExpenses / totalIncomeSum) * 100 : 0;
            $('#expenseProgressBar').css('width', Math.min(expensePercentage, 100) + '%');
            $('#expensePercentageDisplay').text(expensePercentage.toFixed(0));
            
            // Set progress bar color based on percentage
            const progressBar = $('#expenseProgressBar');
            if (expensePercentage > 100) {
                progressBar.removeClass('bg-green-500 bg-yellow-500').addClass('bg-red-500');
            } else if (expensePercentage > 90) {
                progressBar.removeClass('bg-green-500 bg-red-500').addClass('bg-yellow-500');
            } else {
                progressBar.removeClass('bg-yellow-500 bg-red-500').addClass('bg-green-500');
            }
            
            // Update budget health score
            let healthScore = 100;
            if (expensePercentage > 100) {
                healthScore = Math.max(0, 100 - (expensePercentage - 100) * 5);
            } else if (savings < recommendedSavings) {
                healthScore = Math.max(50, 100 - (1 - savings / recommendedSavings) * 50);
            }
            
            $('#healthScore').text(Math.round(healthScore) + '%');
            $('#healthScoreBar').css('width', healthScore + '%');
            
            const healthScoreBar = $('#healthScoreBar');
            const healthScoreText = $('#healthScore');
            if (healthScore < 50) {
                healthScoreBar.removeClass('bg-green-500 bg-yellow-500').addClass('bg-red-500');
                healthScoreText.removeClass('text-green-600 text-yellow-600').addClass('text-red-600');
            } else if (healthScore < 80) {
                healthScoreBar.removeClass('bg-green-500 bg-red-500').addClass('bg-yellow-500');
                healthScoreText.removeClass('text-green-600 text-red-600').addClass('text-yellow-600');
            } else {
                healthScoreBar.removeClass('bg-yellow-500 bg-red-500').addClass('bg-green-500');
                healthScoreText.removeClass('text-yellow-600 text-red-600').addClass('text-green-600');
            }
            
            // Update budget status message
            const budgetStatus = $('#budgetStatus');
            if (remaining < 0) {
                budgetStatus.text('You are over budget. Consider reducing expenses.');
                budgetStatus.removeClass('text-blue-600 text-yellow-600').addClass('text-red-600');
                $('#remainingBudgetDisplay').removeClass('text-green-600').addClass('text-red-600');
            } else if (remaining === 0) {
                budgetStatus.text('Your budget is balanced.');
                budgetStatus.removeClass('text-red-600 text-green-600').addClass('text-blue-600');
                $('#remainingBudgetDisplay').removeClass('text-red-600').addClass('text-green-600');
            } else if (remaining < totalIncomeSum * 0.1) {
                budgetStatus.text('You have a small surplus. Consider saving more.');
                budgetStatus.removeClass('text-red-600 text-green-600').addClass('text-yellow-600');
                $('#remainingBudgetDisplay').removeClass('text-red-600').addClass('text-green-600');
            } else {
                budgetStatus.text('Great job! You have money left to save or invest.');
                budgetStatus.removeClass('text-red-600 text-yellow-600').addClass('text-green-600');
                $('#remainingBudgetDisplay').removeClass('text-red-600').addClass('text-green-600');
            }
        };
        
        // Call updateTotals when page loads and when any input changes
        $(document).ready(function() {
            console.log("Calculator loading with ID: @Model.Id");
            
            // First set form values from model
            @if (!string.IsNullOrEmpty(Model.Id)) {
                <text>
                console.log("Setting form values from model");
                // Use direct property access instead of ToString()
                $('#TotalIncome').val(@Html.Raw(Json.Serialize(Model.TotalIncome)));
                $('#AdditionalIncome').val(@Html.Raw(Json.Serialize(Model.AdditionalIncome)));
                $('#HousingExpenses').val(@Html.Raw(Json.Serialize(Model.HousingExpenses)));
                $('#UtilitiesExpenses').val(@Html.Raw(Json.Serialize(Model.UtilitiesExpenses)));
                $('#TransportationExpenses').val(@Html.Raw(Json.Serialize(Model.TransportationExpenses)));
                $('#FoodExpenses').val(@Html.Raw(Json.Serialize(Model.FoodExpenses)));
                $('#HealthcareExpenses').val(@Html.Raw(Json.Serialize(Model.HealthcareExpenses)));
                $('#EntertainmentExpenses').val(@Html.Raw(Json.Serialize(Model.EntertainmentExpenses)));
                $('#PersonalExpenses').val(@Html.Raw(Json.Serialize(Model.PersonalExpenses)));
                $('#SavingsAllocation').val(@Html.Raw(Json.Serialize(Model.SavingsAllocation)));
                $('#DebtPayment').val(@Html.Raw(Json.Serialize(Model.DebtPayment)));
                $('#OtherExpenses').val(@Html.Raw(Json.Serialize(Model.OtherExpenses)));
                </text>
            } else {
                <text>
                console.log("No budget ID found, using empty form");
                </text>
            }
            
            // Then update calculations
            updateTotals();
            
            // AFTER calculations, initialize charts
            setTimeout(function() {
                initializeCharts();
            }, 100);
            
            // Set up event handlers
            $('input[type="number"]').on('input', function() {
                updateTotals();
                updateCharts();
            });
            
            // Add budget form submit handler
            $('#budgetForm').on('submit', function(e) {
                // Form validation would go here
                
                // For demonstration purposes, we'll just show a success message
                // You would remove this in production as the form would actually submit
                /*
                e.preventDefault();
                alert('Budget saved successfully!');
                */
            });
            
            // Animation effect for cards
            $('.transform').hover(
                function() { $(this).addClass('scale-105'); },
                function() { $(this).removeClass('scale-105'); }
            );
        });
        
        function initializeCharts() {
    try {
        console.log("Initializing simplified charts for testing...");
        
        // Simple pie chart
        const expenseCtx = document.getElementById('expenseBreakdownChart').getContext('2d');
        window.expenseChart = new Chart(expenseCtx, {
            type: 'pie',
            data: {
                labels: ['Housing', 'Utilities', 'Other'],
                datasets: [{
                    data: [30, 20, 50],
                    backgroundColor: ['#818cf8', '#facc15', '#3b82f6']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        
        // Simple bar chart
        const balanceCtx = document.getElementById('incomeExpensesChart').getContext('2d');
        window.balanceChart = new Chart(balanceCtx, {
            type: 'bar',
            data: {
                labels: ['Income', 'Expenses'],
                datasets: [{
                    label: 'Budget Overview',
                    data: [1000, 800],
                    backgroundColor: ['rgba(34, 197, 94, 0.6)', 'rgba(239, 68, 68, 0.6)']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        
        // Simple radar chart
        const radarCtx = document.getElementById('categoryRadarChart').getContext('2d');
        window.radarChart = new Chart(radarCtx, {
            type: 'radar',
            data: {
                labels: ['Housing', 'Utilities', 'Food', 'Other'],
                datasets: [{
                    label: 'Spending',
                    data: [30, 20, 25, 15],
                    backgroundColor: 'rgba(59, 130, 246, 0.2)',
                    borderColor: 'rgb(59, 130, 246)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
        
        console.log("Charts initialized successfully!");
    } catch (error) {
        console.error("Error initializing charts:", error);
    }
}

function updateCharts() {
    // Get values
    const totalIncome = parseFloat($('#TotalIncome').val()) || 0;
    const additionalIncome = parseFloat($('#AdditionalIncome').val()) || 0;
    const totalIncomeSum = totalIncome + additionalIncome;
    
    const housing = parseFloat($('#HousingExpenses').val()) || 0;
    const utilities = parseFloat($('#UtilitiesExpenses').val()) || 0;
    const transportation = parseFloat($('#TransportationExpenses').val()) || 0;
    const food = parseFloat($('#FoodExpenses').val()) || 0;
    const healthcare = parseFloat($('#HealthcareExpenses').val()) || 0;
    const entertainment = parseFloat($('#EntertainmentExpenses').val()) || 0;
    const personal = parseFloat($('#PersonalExpenses').val()) || 0;
    const savings = parseFloat($('#SavingsAllocation').val()) || 0;
    const debt = parseFloat($('#DebtPayment').val()) || 0;
    const other = parseFloat($('#OtherExpenses').val()) || 0;
    
    const totalExpenses = housing + utilities + transportation + food + 
                        healthcare + entertainment + personal + savings + 
                        debt + other;
    
    const remaining = totalIncomeSum - totalExpenses;
    
    // Update Expense Breakdown Pie Chart
    window.expenseChart.data.datasets[0].data = [
        housing, utilities, transportation, food, 
        healthcare, entertainment, personal, 
        savings, debt, other
    ];
    window.expenseChart.update();
    
    // Update Income vs Expenses Bar Chart
    window.balanceChart.data.datasets[0].data = [
        totalIncomeSum, 
        totalExpenses, 
        Math.max(0, remaining) // Only show positive remaining value
    ];
    window.balanceChart.update();
    
    // Update Radar Chart
    // Current spending percentages
    const spendingPercentages = [
        (housing / totalIncomeSum) * 100 || 0,
        (utilities / totalIncomeSum) * 100 || 0,
        (transportation / totalIncomeSum) * 100 || 0,
        (food / totalIncomeSum) * 100 || 0,
        (healthcare / totalIncomeSum) * 100 || 0,
        (entertainment / totalIncomeSum) * 100 || 0,
        (personal / totalIncomeSum) * 100 || 0,
        (debt / totalIncomeSum) * 100 || 0
    ];
    
    // Recommended percentages (midpoint of ranges)
    const recommendedPercentages = [30, 7.5, 12.5, 12.5, 7.5, 7.5, 7.5, 15];
    
    window.radarChart.data.datasets[0].data = spendingPercentages;
    window.radarChart.data.datasets[1].data = recommendedPercentages;
    window.radarChart.update();
    
    // Update pie chart in existing UI
    updatePieChartVisualization(housing, utilities, transportation, food, 
                              healthcare, entertainment, personal, 
                              savings, debt, other, totalExpenses);
}

function updatePieChartVisualization(housing, utilities, transportation, food, 
                                  healthcare, entertainment, personal, 
                                  savings, debt, other, total) {
    // This function updates the simple pie chart visualization
    if (total > 0) {
        // Calculate angles for pie chart slices
        const housingAngle = (housing / total) * 360;
        const utilitiesAngle = (utilities / total) * 360;
        const transportationAngle = (transportation / total) * 360;
        const foodAngle = (food / total) * 360;
        const healthcareAngle = (healthcare / total) * 360;
        const entertainmentAngle = (entertainment / total) * 360;
        const personalAngle = (personal / total) * 360;
        const savingsAngle = (savings / total) * 360;
        const debtAngle = (debt / total) * 360;
        const otherAngle = (other / total) * 360;
        
        // Update the CSS clip paths for the pie chart slices
        // This is a simplified approach; a real implementation would be more complex
        $('#housingSlice').css('clip', `rect(0, 24px, 48px, 0)`);
        $('#utilitiesSlice').css('clip', `rect(0, 48px, 48px, 24px)`);
        // Additional slices would be updated here
    }
}

// Add this after your initializeCharts function
function addFallbackVisualization() {
    // If charts failed to initialize, show fallback
    if (!window.expenseChart) {
        console.log("Adding fallback visualization...");
        
        const housing = parseFloat($('#HousingExpenses').val()) || 0;
        const utilities = parseFloat($('#UtilitiesExpenses').val()) || 0;
        const totalIncome = parseFloat($('#TotalIncome').val()) || 0;
        const additionalIncome = parseFloat($('#AdditionalIncome').val()) || 0;
        const totalIncomeSum = totalIncome + additionalIncome;
        
        // Create a simple div-based visualization
        const expenseContainer = $('#expenseBreakdownChart').parent();
        expenseContainer.empty().append(`
            <div class="flex flex-col items-center justify-center h-full">
                <p class="text-sm text-gray-500 mb-4">Expense Breakdown</p>
                <div class="w-full flex flex-col gap-2">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-indigo-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-700">Housing: $${housing.toFixed(2)}</span>
                        <div class="ml-auto bg-indigo-100 h-4 rounded-full" style="width: ${(housing/totalIncomeSum*100).toFixed(0)}%"></div>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                        <span class="text-xs text-gray-700">Utilities: $${utilities.toFixed(2)}</span>
                        <div class="ml-auto bg-yellow-100 h-4 rounded-full" style="width: ${(utilities/totalIncomeSum*100).toFixed(0)}%"></div>
                    </div>
                    <!-- Add more categories as needed -->
                </div>
            </div>
        `);
    }
}

// Call this at the end of your document ready function
setTimeout(addFallbackVisualization, 500);
    </script>
}